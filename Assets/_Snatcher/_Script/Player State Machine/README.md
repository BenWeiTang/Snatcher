# Player State Machine
The player state machine in Snatcher is an implementation of the a hierarchical Finite State Machine (FSM). When possessing a different enemy ability, the Snatcher moves at a different pace and casts a different ability. Therefore, it is appropriate to implement a hierarchical FSM where the [Character Controller](https://github.com/BenWeiTang/Snatcher/blob/main/Assets/_Snatcher/_Script/Player%20State%20Machine/PlayerStateMachine.cs) is constantly and simultaneously in two states; one is a [Super State](https://github.com/BenWeiTang/Snatcher/blob/main/Assets/_Snatcher/_Script/Player%20State%20Machine/ASuperState.cs) and the other is a [Sub State](https://github.com/BenWeiTang/Snatcher/blob/main/Assets/_Snatcher/_Script/Player%20State%20Machine/ASubState.cs), both of which derived from [APlayerState](https://github.com/BenWeiTang/Snatcher/blob/main/Assets/_Snatcher/_Script/Player%20State%20Machine/APlayerState.cs).

A Super State dictates the movement speed,  animation clips to play as well as the special ability (which is a Sub State) accosiated with the said Super State, and more. A Sub State defines the actual behaviors when the [Character Controller](https://github.com/BenWeiTang/Snatcher/blob/main/Assets/_Snatcher/_Script/Player%20State%20Machine/PlayerStateMachine.cs) is in the state. Examples of Sub States include [IdleState](https://github.com/BenWeiTang/Snatcher/blob/main/Assets/_Snatcher/_Script/Player%20State%20Machine/Concrete%20States/Sub%20States/IdleState.cs), [MoveState](https://github.com/BenWeiTang/Snatcher/blob/main/Assets/_Snatcher/_Script/Player%20State%20Machine/Concrete%20States/Sub%20States/MoveState.cs), and [DashState](https://github.com/BenWeiTang/Snatcher/blob/main/Assets/_Snatcher/_Script/Player%20State%20Machine/Concrete%20States/Sub%20States/DashState.cs), etc. An example of a Super State and its respective, ability-related Sub States is [Invisibility Super State](https://github.com/BenWeiTang/Snatcher/blob/main/Assets/_Snatcher/_Script/Player%20State%20Machine/Concrete%20States/Super%20States/InvisState.cs) with [Invisibility Idle State](https://github.com/BenWeiTang/Snatcher/blob/main/Assets/_Snatcher/_Script/Player%20State%20Machine/Concrete%20States/Sub%20States/InvisIdleState.cs) and [Invisibility Move State](https://github.com/BenWeiTang/Snatcher/blob/main/Assets/_Snatcher/_Script/Player%20State%20Machine/Concrete%20States/Sub%20States/InvisMoveState.cs).

The control of state-switching mechanism can be found in the [Character Controller](https://github.com/BenWeiTang/Snatcher/blob/main/Assets/_Snatcher/_Script/Player%20State%20Machine/PlayerStateMachine.cs) script from line 40 to 54.

In general, the each implementation of the [APlayerState](https://github.com/BenWeiTang/Snatcher/blob/main/Assets/_Snatcher/_Script/Player%20State%20Machine/APlayerState.cs), be it a Super State or a Sub State, relies substantially on a number of public, get-only properties of the Player Controller to function.

There is an implementation of the Factory Pattern in instantiating all states at once for the Character Controller to reference later, and it also prevents GC. See [Player State Factory Manager](https://github.com/BenWeiTang/Snatcher/blob/main/Assets/_Snatcher/_Script/Manager/PlayerStateFactoryManager.cs), which is instantiated by the [Character Controller](https://github.com/BenWeiTang/Snatcher/blob/main/Assets/_Snatcher/_Script/Player%20State%20Machine/PlayerStateMachine.cs) upon `Awake`. Also see [IdleState](https://github.com/BenWeiTang/Snatcher/blob/main/Assets/_Snatcher/_Script/Player%20State%20Machine/Concrete%20States/Sub%20States/IdleState.cs) at line 40 and line 44, as an example of the usage of the Factory Pattern.
